"""
–§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –∏ –≤—ã–∫–ª—é—á–µ–Ω–∏—è –±–æ—Ç–∞.
–ß—Ç–æ –±—ã –ø–æ–º–µ—Å—Ç–∏—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ç–µ–ª–æ async def run_bot():
(–∞ —ç—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ –±—ã –æ–¥–∏–Ω —Ä–∞–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö —Å–µ–π—à–µ–Ω–º–µ–π–∫–µ—Ä (–∏—Å–∫–ª—é—á–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –∏ –æ—à–∏–±–∫–∏))
–ø—Ä–∏—à–ª–æ—Å—å –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å
"""

# -------------------------------- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–æ–¥—É–ª–∏
# -------------------------------- –°—Ç–æ—Ä–æ–Ω–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
# import asyncio
import numpy as np
from sqlalchemy.ext.asyncio import AsyncSession
# -------------------------------- –õ–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏
from working_databases.configs import *

# from dotenv import find_dotenv, load_dotenv  # –î–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
# load_dotenv(find_dotenv())  # –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è

from sql.get_user_data_sql import *

from working_databases.async_engine import *  # +

from working_databases.init_db import *

from working_databases.orm_query_builder import *
from working_databases.query_builder import *


# ----------------------------------------------------------------------------------------------------------------------

#  –í–ª–æ–∂–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤ startup_on (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –∏ —É–¥–∞–ª–µ–Ω–Ω–æ–π –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö:
async def updating_local_db(session_pool: AsyncSession):
    """
    –ª–æ–≥–∏–∫–∞: –∫–∞–∫ —Ç–æ–ª—å–∫–æ –∑–∞–ø—É—Å–∫–∞–µ–º —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–¥ –∞–π–¥–∏ —Å –≤–Ω–µ—à–Ω–µ–π –±–¥
    –î–µ–ª–∞–µ–º –≤—ã–±–æ—Ä–∫—É –∏–∑ –ª–æ–∫–∞–ª –±–¥ (–≤—ã–¥–∞—Å—Ç –ª–∏–±–æ —Å–ø–∏—Å–æ–∫, –ª–∏–±–æ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫):
    - –µ—Å–ª–∏ –Ω–µ—Ç –Ω–∏—á–µ–≥–æ, —Ç–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–æ–ª–Ω—è–µ–º –±–¥, –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–æ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∏ –ø–æ—Ç–æ–º –Ω–∞–ø–æ–ª–Ω—è–µ–º.

    """

    # –î–µ–ª–∞–µ–º –≤—ã–±–æ—Ä–∫—É id_tg –∏–∑ –ª–æ–∫–∞–ª –±–¥ (–≤—ã–¥–∞—Å—Ç –ª–∏–±–æ —Å–ø–∏—Å–æ–∫, –ª–∏–±–æ –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫):
    raw_data_local_db = await get_id_tg_in_users(session_pool)  # +


    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å–ø–∏—Å–æ–∫ –∫–æ—Ä—Ç–µ–∂–µ–π) –≤ —Å–ø–∏—Å–æ–∫, —Ç–∫ —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ, —á—Ç–æ –ø–æ–Ω–∏–º–∞–µ—Ç –Ω—É–º–ø–∏.
    get_id_tg_list_local_db = []
    for row in raw_data_local_db:
        if row is None: # todo –ü–æ—Ç–æ–º –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å, –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –Ω—É–ª–∏ –∏ –ø—É—Å—Ç–æ—Ç—ã. –í–æ–∑–º–æ–ª–∂–Ω—ã –æ—à–∏–±–∫–∏!
            print(row)
        else:
            get_id_tg_list_local_db.append(int(row))
    # print(f' –î–µ–ª–∞–µ–º –≤—ã–±–æ—Ä–∫—É –≤—Å–µ—Ö id_tg –∏–∑ –õ–æ–∫–∞–ª –ë–î: {get_id_tg_list_local_db}')  # +


    # –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç:
    if not get_id_tg_list_local_db:
        print('–¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞—è.')

        # ------------------ –†–∞–∑–¥–µ–ª –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª –ë–î (+ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö):
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö —á–µ—Ä–µ–∑ —Å—ã—Ä–æ–π –∑–∞–ø—Ä–æ—Å:
        # –≤ –≤—ã–±–æ—Ä–∫—É –ø–æ–ø–∞–¥—É—Ç –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –Ω–µ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö (—É–≤–æ–ª–µ–Ω–Ω—ã—Ö).
        data = await get_data_in_jarvis(
            engine_obj=await get_async_engine(CONFIG_JAR_ASYNCPG),
            sql=user_data_sql_text
        )  # todo !!! fetchall()

        # –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ë–î –ø—Ä–æ–µ–∫—Ç–∞ –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ –û–†–ú:
        # –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ, –æ—Ç—Å–µ–∏–≤–∞—é—Ç—Å—è —Å—Ç—Ä–æ–∫–∏ —Å –ø—É—Å—Ç—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –≤ —Ö–æ—Ç—è –±—ã 1 –∫–æ–ª–æ–Ω–∫–µ –∏ —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è –Ω–∞ 2 —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏–µ ( \
        # –±–∞–≥–∏ –∏ –Ω–æ—Ä–º –¥–∞–Ω–Ω—ã–µ.
        # !! –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è 2 —Å–µ—Å—Å–∏–∏ –µ—â–µ –æ–¥–Ω–∞ –≤ –º–∏–¥–µ–ª –≤–µ—Ä–∏
        bugs = await insert_data(data, session_pool)
        # –ï—Å—Ç—å –ø—Ä–∏–Ω—Ç—ã –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –≤ —Ñ—É–Ω–∫—Ü–∏–∏ üëÜ

    else:
        print('–¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø—É—Å—Ç–∞—è.')
        # –î–µ–ª–∞–µ–º –≤—ã–±–æ—Ä–∫—É –≤—Å–µ—Ö id_tg –∏–∑ –î–∂–∞—Ä–≤–∏—Å–∞ (–∑–∞–ø—Ä–æ—Å –∫ —Ç–∞–±–ª–∏—Ü–µ –±–æ—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Ö–æ—Å—Ç–µ):
        raw_data_jarvis = await get_data_in_jarvis(
            engine_obj=await get_async_engine(CONFIG_JAR_ASYNCPG),
            sql=table_for_reg_bot
        )
        # print(f'–°—ã—Ä–∞—è –≤—ã–±–æ—Ä–∫–∞ –≤—Å–µ—Ö id_tg –∏–∑ –î–∂–∞—Ä–≤–∏—Å–∞: {raw_data_jarvis}')
        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å–ø–∏—Å–æ–∫, —Ç–∫ —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ, —á—Ç–æ –ø–æ–Ω–∏–º–∞–µ—Ç –Ω—É–º–ø–∏.
        get_id_tg_list_in_jarvis = []
        for row in raw_data_jarvis:
            if row is None:# todo –ü–æ—Ç–æ–º –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å, –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –Ω—É–ª–∏ –∏ –ø—É—Å—Ç–æ—Ç—ã
                print(row)
            else:
                get_id_tg_list_in_jarvis.append(int(row[0]))  # +
        # print(f' –î–µ–ª–∞–µ–º –≤—ã–±–æ—Ä–∫—É –≤—Å–µ—Ö id_tg –∏–∑ –î–∂–∞—Ä–≤–∏—Å–∞ (–∑–∞–ø—Ä–æ—Å –∫ —Ç–∞–±–ª–∏—Ü–µ –±–æ—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Ö–æ—Å—Ç–µ):'
        #       f' {get_id_tg_list_in_jarvis}')

        # ------------------------------------------------ NumPy
        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å–ø–∏—Å–∫–∏ –≤ –º–∞—Å—Å–∏–≤—ã (–æ–±—ä–µ–∫—Ç—ã –Ω—É–º–ø–∏):
        local_db_array = np.array(get_id_tg_list_local_db)  # –†–∞–±–æ—Ç–∞–µ—Ç –∏ –ø—Ä–æ—Å—Ç–æ —Å–æ —Å–ø–∏—Å–∫–∞–º–∏, –Ω–æ —Ä–∞–∑ —É–∂ –Ω–∞–ø–∏—Å–∞–ª –ø—É—Ü—Å—Ç—å
        jarvis_db_array = np.array(get_id_tg_list_in_jarvis) # –æ—Å—Ç–∞—é—Ç—Å—è.

        # print(local_db_array)
        # print(jarvis_db_array)

        # –ß–∏—Å—Ç–∏–º —Å–ø–∏—Å–∫–∏ (—á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å –≤ –ø–æ—Å–ª–µ–¥—É—é—â–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫ —Å—Ç–∞—Ä—ã–º –æ–±—ä–µ–∫—Ç–∞–º –≤ —Å–ø–∏—Å–∫–µ - –Ω–æ–≤—ã—Ö):
        get_id_tg_list_local_db.clear()
        get_id_tg_list_in_jarvis.clear()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ä–∞–≤–Ω—ã –ª–∏ –º–∞—Å—Å–∏–≤—ã –ø–æ—ç–ª–µ–º–µ–Ω—Ç–Ω–æ (—Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –≤—ã–±–æ—Ä–∫–∏ –∏–∑ 2-—Ö –±–∞–∑):
        arrays_equal: bool = np.array_equal(local_db_array, jarvis_db_array)  # +
        #  –§—É–Ω–∫—Ü–∏—è np.array_equal –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —Ä–∞–≤–Ω—ã –ª–∏ –¥–≤–∞ –º–∞—Å—Å–∏–≤–∞.
        #  –û–Ω–∞ –≤–µ—Ä–Ω–µ—Ç True, –µ—Å–ª–∏ –º–∞—Å—Å–∏–≤—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã –ø–æ —Ñ–æ—Ä–º–µ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É, –∏ False –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ.

        # print(f'–ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ä–∞–≤–Ω—ã –ª–∏ –º–∞—Å—Å–∏–≤—ã –ø–æ—ç–ª–µ–º–µ–Ω—Ç–Ω–æ (—Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –≤—ã–±–æ—Ä–∫–∏ –∏–∑ 2-—Ö –±–∞–∑): {arrays_equal}, '
        #       f'local_db_array: {len(local_db_array)}, jarvis_db_array: {len(jarvis_db_array)}')

        #  –µ—Å–ª–∏ –º–∞—Å—Å–∏–≤—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã –ø–æ —Ñ–æ—Ä–º–µ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
        if arrays_equal is True:
            print(f'–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∞–∫—Ç—É–∞–ª—å–Ω–∞ –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.')

        else:
            # 1. –ù–∞–π–¥–µ–º —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Ö–æ—Å—Ç–µ:
            # –ù–∞–π–¥–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –≤ (local_db_array), –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤–æ –≤—Ç–æ—Ä–æ–º –º–∞—Å—Å–∏–≤–µ (jarvis_db_array):
            not_values_in_jarvis_db = np.setdiff1d(local_db_array, jarvis_db_array)
            if len(not_values_in_jarvis_db) == 0:
                # print(f'–ê–Ω–∞–ª–∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: —É–≤–æ–ª–µ–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ (—É–¥–∞–ª–µ–Ω–Ω—ã–µ –∏–∑ –±–¥.) - –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.')
                ...
            else:
                print(f'–ê–Ω–∞–ª–∏–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: –∏–º–µ—é—Ç—Å—è –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ (—É–¥–∞–ª–µ–Ω–Ω—ã–µ –∏–∑ –±–¥.). '
                      f'–ü—Ä–æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–º–µ—Ç–∫—É –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ –æ–± –∏—Ö —É–¥–∞–ª–µ–Ω–∏–∏:\n{not_values_in_jarvis_db}')

                # –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω—ã—Ö –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–ø–∏—Å–∏.
                for id_tg in not_values_in_jarvis_db:
                    id = int(id_tg)  # –≤ –Ω—É–ø–∏ int64 - –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ !!!
                    #
                    # –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å—Ç—Ä–æ–∫–µ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω—ã–π:
                    await update_delet_local_db(id, session_pool)

                # todo –∞–ø–¥–µ–π—Ç –∑–∞–ø–∏—Å–µ–π  —É–¥–∞–ª–µ–Ω ( !!! –ù–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å. –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ—Ç, –∫–æ–≥–¥–∞ –±—É–¥—É—Ç —É–≤–æ–ª–µ–Ω–Ω—ã–µ)


            # 2. –ù–∞–π–¥–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Ö–æ—Å—Ç–µ (–≤–Ω–æ–≤—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–æ—Ç–æ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏):
            not_values_in_local_db = np.setdiff1d(jarvis_db_array , local_db_array)
            if len(not_values_in_local_db) == 0:
                # print(f'–ê–Ω–∞–ª–∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: –Ω–æ–≤—ã—Ö –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–µ–≤–µ—Ä–µ'
                #       f' –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ, –¥–∞–Ω–Ω—ã–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç.')
                ...
            else:
                print(f'–ê–Ω–∞–ª–∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–æ–≤—ã–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏. '
                      f'–î–æ–±–∞–≤–∏–º –∏—Ö –±–∞–∑—É:\n{not_values_in_local_db}')

                # —Ñ–æ—Ä–º–∏—Ä—É–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                # –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω—ã–µ –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–ø–∏—Å–∏.
                int_id_tg_list = []
                for id_tg in not_values_in_local_db:
                    id = int(id_tg) # –≤ –Ω—É–ø–∏ int64 - –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ !!!
                    int_id_tg_list.append(id)  #  –ø–µ—Ä–µ–¥–∞–µ–º —Å—Ä–∞–∑—É –≤–µ—Å—å —Å–ø–∏—Å–æ–∫

                    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å–ø–∏—Å–æ–∫ –≤ —Å—Ç—Ä–æ–∫—É, –ø—Ä–∏–≥–æ–¥–Ω—É—é –¥–ª—è SQL-–∑–∞–ø—Ä–æ—Å–∞
                    tg_list_str = ', '.join(f"'{tg}'" for tg in int_id_tg_list)

                    # –ò–∑–≤–ª–µ–∫–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –∏—Å–∫–æ–º–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
                    # ! –ó–∞–ø–∏—Å—å –≤ —Ñ—É–Ω–∫—Ü–∏—é —Ç–æ–ª—å–∫–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ !!! –ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–º–∏ - –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ –∏–∑-–∑–∞ *args
                data_user = await get_data_in_jarvis(
                    await get_async_engine(CONFIG_JAR_ASYNCPG), user_data_sql_new, tg_list_str) # +
                # –ó–¥–µ—Å—å –Ω–∞ –≤—ã—Ö–æ–¥–µ —Ç–æ–ª—å–∫–æ –∫–æ—Ä—Ç–µ–∂, –±–æ–ª—å—à–µ –Ω–∏–∫–∞–∫.
                # –í –∏–¥–µ–∞–ª–µ –±—ã–ª–æ –±—ã –≤—ã–¥–∞—Ç—å —Å–ª–æ–≤–∞—Ä—å –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é –≤ –û–†–ú –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π, –Ω–æ —É–≤—ã —ç—Ç–æ –ø—Ä–æ–±–ª–µ–±–Ω–æ.
                print(f'–í—ã–±–æ—Ä–∫–∞ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤  –ª–æ–∫–∞–ª –±–¥: {data_user}')

                # –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ë–î –ø—Ä–æ–µ–∫—Ç–∞ –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ –û–†–ú:
                # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:
                # –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ, –æ—Ç—Å–µ–∏–≤–∞—é—Ç—Å—è —Å—Ç—Ä–æ–∫–∏ —Å –ø—É—Å—Ç—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –≤ —Ö–æ—Ç—è –±—ã 1 –∫–æ–ª–æ–Ω–∫–µ –∏ —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è \
                # –Ω–∞ 2 —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏–µ (–±–∞–≥–∏ –∏ –Ω–æ—Ä–º –¥–∞–Ω–Ω—ã–µ):
                bugs = await insert_data(data_user, session_pool)
                # –ï—Å—Ç—å –ø—Ä–∏–Ω—Ç—ã –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –≤ —Ñ—É–Ω–∫—Ü–∏–∏ üëÜ

# -------------------- –∫–æ–Ω–µ—Ü —Ñ—É–Ω–∫—Ü–∏–∏.




            # -------------------- –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏ –±–æ—Ç–∞:

async def startup_on(session_pool: AsyncSession):
    """–û–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä—è–¥ –ø—Ä–æ–≥—Ä–∞–º–º –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è  –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞"""

    # 0. –°–æ–∑–¥–∞–Ω–∏–µ –õ–æ–∫–∞–ª –ë–î.
    await create_db()  # +

    # --------------- tests

    await updating_local_db(session_pool)  # todo

    # --------------- tests

    # –≤–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É (–ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏) –µ—Å–ª–∏ –±–∞–∑–∞ –µ—Å—Ç—å
    # —Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ª–∏—á–∏—è,
    # –µ—Å–ª–∏ –Ω–µ—Ç —Ç–æ –Ω–∏—á–µ–≥–æ

    # ------------------

    print('–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω, –≤—Å–µ –Ω–æ—Ä–º!')


# -------------------- –ü—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏
async def shutdown_on():
    print('–ë–æ—Ç –ª–µ–≥!')



# --------------------------- –æ—à—Ä—ã–∑–∫–∏
# # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–∞—Å—Å–∏–≤ –≤ —Å–ª–æ–≤–∞—Ä—å –¥–ª—è –ø–µ—Ä–¥–∞—á–∏ –≤ –û–†–ú –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –ë–î:
# new_id_tg_dict = [{'id_tg': row} for row in not_values_in_local_db]
# print(new_id_tg_dict)
